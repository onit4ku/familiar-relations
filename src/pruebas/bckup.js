const individualList = [
    {
        annotationSets: [],
        id: 12,
        name: "mujer1",
        sex: "FEMALE",
        karyotypicSex: "XY",
        ethnicity: "white caucasian",
        species: {
            taxonomyCode: "",
            scientificName: "",
            commonName: ""
        },
        population: {
            name: "Spain",
            subpopulation: "",
            description: ""
        },
        dateOfBirth: "1950",
        release: 1,
        version: 1,
        creationDate: "20171204104557",
        status: {
            name: "READY",
            date: "20161204104557",
            message: ""
        },
        lifeStatus: "UNKNOWN",
        affectationStatus: "AFFECTED",
        phenotypes: [
            {
                id: "F72",
                name: "Severe intellectual disabilities",
                source: "ICD10"
            },
            {
                id: "HP:0610864",
                name: "Intellectual disability, severe",
                source: "HPO"
            }
        ]
    },
    {
        annotationSets: [],
        id: 43,
        name: "arnaldo",
        sex: "MALE",
        karyotypicSex: "XY",
        ethnicity: "white caucasian",
        species: {
            taxonomyCode: "",
            scientificName: "",
            commonName: ""
        },
        population: {
            name: "Spain",
            subpopulation: "",
            description: ""
        },
        dateOfBirth: "1920",
        release: 1,
        version: 1,
        creationDate: "20171204104557",
        status: {
            name: "READY",
            date: "20171204104557",
            message: ""
        },
        lifeStatus: "UNKNOWN",
        affectationStatus: "AFFECTED",
        phenotypes: [
            {
                id: "F72",
                name: "Severe intellectual disabilities",
                source: "ICD10"
            },
            {
                id: "HP:1010864",
                name: "Intellectual disability, severe",
                source: "HPO"
            }
        ]
    },
    {
        annotationSets: [],
        id: 243,
        name: "manuel",
        sex: "MALE",
        karyotypicSex: "XY",
        ethnicity: "white caucasian",
        species: {
            taxonomyCode: "",
            scientificName: "",
            commonName: ""
        },
        population: {
            name: "Spain",
            subpopulation: "",
            description: ""
        },
        dateOfBirth: "1920",
        release: 1,
        version: 1,
        creationDate: "20171204104557",
        status: {
            name: "READY",
            date: "20171204104557",
            message: ""
        },
        lifeStatus: "UNKNOWN",
        affectationStatus: "AFFECTED",
        phenotypes: [
            {
                id: "F72",
                name: "Severe intellectual disabilities",
                source: "ICD10"
            },
            {
                id: "HP:3019864",
                name: "Intellectual disability, severe",
                source: "HPO"
            }
        ]
    },
    {
        annotationSets: [],
        id: 212,
        name: "estrudel",
        sex: "MALE",
        karyotypicSex: "XY",
        ethnicity: "white caucasian",
        species: {
            taxonomyCode: "",
            scientificName: "",
            commonName: ""
        },
        population: {
            name: "Spain",
            subpopulation: "",
            description: ""
        },
        dateOfBirth: "1920",
        release: 1,
        version: 1,
        creationDate: "20171204104557",
        status: {
            name: "READY",
            date: "20171204104557",
            message: ""
        },
        lifeStatus: "UNKNOWN",
        affectationStatus: "AFFECTED",
        phenotypes: [
            {
                id: "F72",
                name: "Severe intellectual disabilities",
                source: "ICD10"
            },
            {
                id: "HP:0010864",
                name: "Intellectual disability, severe",
                source: "HPO"
            }
        ]
    },
    {
        annotationSets: [],
        id: 267,
        name: "ricardo",
        sex: "MALE",
        karyotypicSex: "XY",
        ethnicity: "white caucasian",
        species: {
            taxonomyCode: "",
            scientificName: "",
            commonName: ""
        },
        population: {
            name: "Spain",
            subpopulation: "",
            description: ""
        },
        dateOfBirth: "1920",
        release: 1,
        version: 1,
        creationDate: "20171204104557",
        status: {
            name: "READY",
            date: "20171204104557",
            message: ""
        },
        lifeStatus: "UNKNOWN",
        affectationStatus: "AFFECTED",
        phenotypes: [
            {
                id: "F72",
                name: "Severe intellectual disabilities",
                source: "ICD10"
            },
            {
                id: "HP:0010864",
                name: "Intellectual disability, severe",
                source: "HPO"
            }
        ]
    },
    {
        annotationSets: [],
        id: 86,
        name: "knucles",
        sex: "MALE",
        karyotypicSex: "XY",
        ethnicity: "white caucasian",
        species: {
            taxonomyCode: "",
            scientificName: "",
            commonName: ""
        },
        population: {
            name: "Spain",
            subpopulation: "",
            description: ""
        },
        dateOfBirth: "1920",
        release: 1,
        version: 1,
        creationDate: "20171204104557",
        status: {
            name: "READY",
            date: "20171204104557",
            message: ""
        },
        lifeStatus: "UNKNOWN",
        affectationStatus: "AFFECTED",
        phenotypes: [
            {
                id: "F72",
                name: "Severe intellectual disabilities",
                source: "ICD10"
            },
            {
                id: "HP:0016864",
                name: "Intellectual disability, severe",
                source: "HPO"
            }
        ]
    },
    {
        annotationSets: [],
        id: 280,
        name: "fafweaf",
        sex: "FEMALE",
        karyotypicSex: "XY",
        ethnicity: "white caucasian",
        species: {
            taxonomyCode: "",
            scientificName: "",
            commonName: ""
        },
        population: {
            name: "Spain",
            subpopulation: "",
            description: ""
        },
        dateOfBirth: "1920",
        release: 1,
        version: 1,
        creationDate: "20171204104557",
        status: {
            name: "READY",
            date: "20171204104557",
            message: ""
        },
        lifeStatus: "UNKNOWN",
        affectationStatus: "AFFECTED",
        phenotypes: [
            {
                id: "F72",
                name: "Severe intellectual disabilities",
                source: "ICD10"
            },
            {
                id: "HP:0070864",
                name: "Intellectual disability, severe",
                source: "HPO"
            }
        ]
    },
    {
        annotationSets: [],
        id: 523,
        name: "0013-010-COHO_7",
        sex: "FEMALE",
        karyotypicSex: "XY",
        ethnicity: "white caucasian",
        species: {
            taxonomyCode: "",
            scientificName: "",
            commonName: ""
        },
        population: {
            name: "Spain",
            subpopulation: "",
            description: ""
        },
        dateOfBirth: "1920",
        release: 1,
        version: 1,
        creationDate: "20171204104557",
        status: {
            name: "READY",
            date: "20171204104557",
            message: ""
        },
        lifeStatus: "UNKNOWN",
        affectationStatus: "AFFECTED",
        phenotypes: [
            {
                id: "F72",
                name: "Severe intellectual disabilities",
                source: "ICD10"
            },
            {
                id: "HP:0019864",
                name: "Intellectual disability, severe",
                source: "HPO"
            }
        ]
    }
];

/* reducers*/
function table(state = [], action) {
    if (action.type == "ADD_INDIVIDUAL") {
        return state.concat([action.obj]);
    } else if (action.type == "DELETE_INDIVIDUAL") {
        var index = state.indexOf(action.obj);
        state.splice(index, 1);
        return state;
    } else if (action.type == "UPDATE_INDIVIDUAL") {
        return state.map((todo, index, arr) => {
            if (arr[index].id.toString() === action.obj.id) {
                let obj = {};
                obj[action.obj.name] = action.obj.value;
                return Object.assign({}, todo, obj);
            }
            return todo;
        });
    } else {
        return state;
    }
}
function filter(state = "", action) {
    if (action.type == "FILTER_TEXT") {
        return action.text;
    } else {
        return state;
    }
}

var initialState = {
    filter: "",
    table: individualList
};

let reducer = Redux.combineReducers({ table, filter });
let store = Redux.createStore(reducer, initialState);

class Individuals extends React.Component {
    constructor(props) {
        super(props);
    }
    render() {
        return (
            <div>
                <SearchBar filterText={this.props.value.filter} />
                <IndividualTable
                    individuals={this.props.value.table}
                    filterText={this.props.value.filter}
                />
            </div>
        );
    }
}
function SearchBar(props) {
    return (
        <div>
            <input
                type="text"
                placeholder="Search..."
                value={props.filterText}
                onChange={evt => {
                    store.dispatch({
                        type: "FILTER_TEXT",
                        text: evt.target.value
                    });
                }}
            />
        </div>
    );
}

function IndividualTable(props) {
    var filterText = props.filterText;
    var individual = props.individuals.map(function(individual) {
        if (individual.name.indexOf(filterText) === -1) {
            return;
        }
        return <IndividualRow individual={individual} key={individual.id} />;
    });
    return (
        <div>
            <button
                type="button"
                onClick={() =>
                    store.dispatch({
                        type: "ADD_INDIVIDUAL",
                        obj: {
                            category: "",
                            id: (
                                +new Date() + Math.floor(Math.random() * 999999)
                            ).toString(36),
                            name: "",
                            price: "",
                            qty: 0
                        }
                    })
                }
                className="btn btn-success pull-right"
            >
                Add
            </button>
            <table className="table table-bordered">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>ID</th>
                        <th>Sex</th>
                        <th>karyotypicSex</th>
                        <th>ethnicity</th>
                        <th>population</th>
                        <th>dateOfBirth</th>
                        <th>lifeStatus</th>
                        <th>affectationStatus</th>
                    </tr>
                </thead>

                <tbody>{individual}</tbody>
            </table>
        </div>
    );
}

function IndividualRow(props) {
    return (
        <tr className="eachRow">
            <EditableCell
                cellData={{
                    type: "name",
                    value: props.individual.name,
                    id: props.individual.id
                }}
            />
            <EditableCell
                cellData={{
                    type: "id",
                    value: props.individual.id,
                    id: props.individual.id
                }}
            />
            <EditableCell
                cellData={{
                    type: "sex",
                    value: props.individual.sex,
                    id: props.individual.id
                }}
            />
            <EditableCell
                cellData={{
                    type: "karyotypicSex",
                    value: props.individual.karyotypicSex,
                    id: props.individual.id
                }}
            />
            <EditableCell
                cellData={{
                    type: "ethnicity",
                    value: props.individual.ethnicity,
                    id: props.individual.id
                }}
            />
            <EditableCell
                cellData={{
                    type: "population",
                    value: props.individual.population.name,
                    id: props.individual.id
                }}
            />
            <EditableCell
                cellData={{
                    type: "dateOfBirth",
                    value: props.individual.dateOfBirth,
                    id: props.individual.id
                }}
            />
            <EditableCell
                cellData={{
                    type: "lifeStatus",
                    value: props.individual.lifeStatus,
                    id: props.individual.id
                }}
            />
            <EditableCell
                cellData={{
                    type: "affectationStatus",
                    value: props.individual.affectationStatus,
                    id: props.individual.id
                }}
            />
            <td className="del-cell">
                <input
                    type="button"
                    onClick={() =>
                        store.dispatch({
                            type: "DELETE_INDIVIDUAL",
                            obj: props.individual
                        })
                    }
                    value="X"
                    className="del-btn"
                />
            </td>
                    <td className="apply-row">
                <input
                    type="button"
                    onClick={() =>
                        store.dispatch({
                            type: "UPDATE_INDIVIDUAL",
                            obj: props.individual
                        })
                    }
                    value="V"
                    className="del-btn"
                />
            </td>
        </tr>
    );
}
function EditableCell(props) {
    return (
        <td>
            <input
                type="text"
                id={props.cellData.id}
                value={props.cellData.value}
                name={props.cellData.type}
                onChange={evt => {
                    store.dispatch({
                        type: "UPDATE_INDIVIDUAL",
                        obj: {
                            id: evt.target.id,
                            name: evt.target.name,
                            value: evt.target.value
                        }
                    });
                }}
            />
        </td>
    );
}

const render = () =>
    ReactDOM.render(
        <Individuals value={store.getState()} />,
        document.getElementById("root")
    );
render();
store.subscribe(render);